{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"settings-container\"\n};\nconst _hoisted_2 = {\n  class: \"notice-management\"\n};\nconst _hoisted_3 = {\n  class: \"button-group\"\n};\nconst _hoisted_4 = [\"onClick\"];\nconst _hoisted_5 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[4] || (_cache[4] = _createElementVNode(\"h2\", null, \"系统设置\", -1 /* HOISTED */)), _createCommentVNode(\" 通知管理 \"), _createElementVNode(\"div\", _hoisted_2, [_cache[3] || (_cache[3] = _createElementVNode(\"h3\", null, \"通知管理\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.newNoticeTitle = $event),\n    placeholder: \"输入通知标题\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.newNoticeTitle]]), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.newNoticeContent = $event),\n    placeholder: \"输入新的通知\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.newNoticeContent]]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.addNotice && $options.addNotice(...args))\n  }, \"添加通知\"), _createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.sortedNotices, notice => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: notice.id,\n      class: _normalizeClass({\n        'pinned-notice': notice.isPinned === 1\n      })\n    }, [_createTextVNode(_toDisplayString(notice.title) + \" - \" + _toDisplayString(notice.content) + \" \", 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n      onClick: $event => $options.togglePin(notice.id)\n    }, _toDisplayString(notice.isPinned === 1 ? '取消置顶' : '置顶'), 9 /* TEXT, PROPS */, _hoisted_4), _createElementVNode(\"button\", {\n      onClick: $event => $options.deleteNotice(notice.id)\n    }, \"删除\", 8 /* PROPS */, _hoisted_5)])], 2 /* CLASS */);\n  }), 128 /* KEYED_FRAGMENT */))])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_createCommentVNode","_hoisted_2","_cache","$event","$data","newNoticeTitle","placeholder","newNoticeContent","onClick","args","$options","addNotice","_Fragment","_renderList","sortedNotices","notice","key","id","_normalizeClass","isPinned","_createTextVNode","_toDisplayString","title","content","_hoisted_3","togglePin","_hoisted_4","deleteNotice","_hoisted_5"],"sources":["/home/toma/桌面/projects/RuralWebApp/frontend/src/components/SystemSetting.vue"],"sourcesContent":["<!-- SystemSetting.vue -->\r\n<template>\r\n  <div class=\"settings-container\">\r\n    <h2>系统设置</h2>\r\n\r\n    <!-- 通知管理 -->\r\n    <div class=\"notice-management\">\r\n      <h3>通知管理</h3>\r\n      <input v-model=\"newNoticeTitle\" placeholder=\"输入通知标题\" />\r\n      <textarea v-model=\"newNoticeContent\" placeholder=\"输入新的通知\"></textarea>\r\n      <button @click=\"addNotice\">添加通知</button>\r\n      <ul>\r\n        <li v-for=\"(notice) in sortedNotices\" :key=\"notice.id\" :class=\"{ 'pinned-notice': notice.isPinned === 1 }\">\r\n          {{ notice.title }} - {{ notice.content }}\r\n          <div class=\"button-group\">\r\n            <button @click=\"togglePin(notice.id)\">\r\n              {{ notice.isPinned === 1 ? '取消置顶' : '置顶' }}\r\n            </button>\r\n            <button @click=\"deleteNotice(notice.id)\">删除</button>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      newNoticeTitle: '',\r\n      newNoticeContent: '',\r\n      notices: [],\r\n      headerImage: null,\r\n      currentHeaderImage: null,\r\n    };\r\n  },\r\n  async created() {\r\n    await this.fetchNotices();\r\n    await this.fetchCurrentHeaderImage();\r\n  },\r\n  computed: {\r\n    sortedNotices() {\r\n      return this.notices.slice().sort((a, b) => {\r\n        return b.isPinned - a.isPinned;\r\n      });\r\n    },\r\n  },\r\n  methods: {\r\n    handleFileUpload(event) {\r\n      this.headerImage = event.target.files[0];\r\n    },\r\n    async uploadHeaderImage() {\r\n      const formData = new FormData();\r\n      formData.append('image', this.headerImage);\r\n      try {\r\n        const response = await axios.post('http://localhost:5000/api/upload-header-image', formData, {\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n          },\r\n        });\r\n        this.currentHeaderImage = response.data.path;\r\n        alert('头图上传成功');\r\n      } catch (error) {\r\n        console.error('头图上传失败:', error);\r\n      }\r\n    },\r\n    async deleteHeaderImage() {\r\n      try {\r\n        await axios.delete('http://localhost:5000/api/delete-header-image');\r\n        this.currentHeaderImage = null;\r\n        alert('头图删除成功');\r\n      } catch (error) {\r\n        console.error('头图删除失败:', error);\r\n      }\r\n    },\r\n    async fetchNotices() {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/api/notices');\r\n        this.notices = response.data;\r\n      } catch (error) {\r\n        console.error('获取通知失败:', error);\r\n      }\r\n    },\r\n    async addNotice() {\r\n      if (!this.newNoticeTitle.trim() || !this.newNoticeContent.trim()) {\r\n        alert('通知标题和内容不能为空');\r\n        return;\r\n      }\r\n      try {\r\n        const response = await axios.post('http://localhost:5000/api/notices', {\r\n          title: this.newNoticeTitle,\r\n          content: this.newNoticeContent,\r\n        });\r\n        this.notices.push(response.data);\r\n        this.newNoticeTitle = '';\r\n        this.newNoticeContent = '';\r\n        alert('通知添加成功');\r\n      } catch (error) {\r\n        console.error('添加通知失败:', error);\r\n      }\r\n    },\r\n    async deleteNotice(noticeId) {\r\n      console.log('Deleting notice with ID:', noticeId); // 添加日志输出\r\n      try {\r\n        await axios.delete(`http://localhost:5000/api/notices/${noticeId}`);\r\n        // 使用 filter 方法移除指定ID的通知\r\n        this.notices = this.notices.filter((notice) => notice.id !== noticeId);\r\n        alert('通知已删除');\r\n      } catch (error) {\r\n        if (error.response.status === 404) {\r\n          alert('通知未找到，请检查通知ID是否正确');\r\n        } else {\r\n          console.error('删除通知失败:', error);\r\n        }\r\n      }\r\n    },\r\n    async togglePin(noticeId) {\r\n      try {\r\n        const action = this.notices.find(notice => notice.id === noticeId).isPinned === 1 ? 'unpin' : 'pin';\r\n        const response = await axios.put(`http://localhost:5000/api/notices/${noticeId}/${action}`);\r\n        if (response.data && response.data.notice) {\r\n          // 更新本地数据\r\n          this.notices = this.notices.map((notice) =>\r\n            notice.id === noticeId ? response.data.notice : notice\r\n          );\r\n          alert(`${action === 'pin' ? '通知已置顶' : '通知已取消置顶'}`);\r\n        } else {\r\n          console.error(`${action === 'pin' ? '置顶' : '取消置顶'}通知响应格式不正确:`, response.data);\r\n        }\r\n      } catch (error) {\r\n        console.error(`${action === 'pin' ? '置顶' : '取消置顶'}通知失败:`, error);\r\n      }\r\n    },\r\n    async fetchCurrentHeaderImage() {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/api/get-header-image');\r\n        this.currentHeaderImage = response.data.path;\r\n      } catch (error) {\r\n        console.error('获取当前头图失败:', error);\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.settings-container {\r\n  padding: 20px;\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n}\r\n\r\nh2 {\r\n  font-size: 24px;\r\n  text-align: center;\r\n  margin-bottom: 20px;\r\n}\r\n.pinned-notice {\r\n  background-color: #ffebcc; /* 例如，使用黄色背景 */\r\n  font-weight: bold;\r\n}\r\n\r\n.notice-management {\r\n  margin-bottom: 20px;\r\n  padding: 15px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 5px;\r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.notice-management h3 {\r\n  font-size: 20px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\ninput, textarea {\r\n  width: calc(100% - 22px);\r\n  padding: 10px;\r\n  margin-bottom: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 5px;\r\n}\r\n\r\n.button-group {\r\n  display: flex;\r\n  gap: 5px;\r\n}\r\n\r\nbutton {\r\n  padding: 10px 15px;\r\n  background-color: #007BFF;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 5px;\r\n  cursor: pointer;\r\n  margin-right: 5px;\r\n}\r\n\r\nbutton:hover {\r\n  background-color: #0056b3;\r\n}\r\n\r\n.current-header-image img {\r\n  max-width: 100%;\r\n  margin-bottom: 10px;\r\n}\r\n\r\nul {\r\n  list-style-type: none;\r\n  padding: 0;\r\n}\r\n\r\nli {\r\n  margin-bottom: 10px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n</style>"],"mappings":";;EAEOA,KAAK,EAAC;AAAoB;;EAIxBA,KAAK,EAAC;AAAmB;;EAQnBA,KAAK,EAAC;AAAc;mBAdnC;mBAAA;;uBAEEC,mBAAA,CAqBM,OArBNC,UAqBM,G,0BApBJC,mBAAA,CAAa,YAAT,MAAI,sBAERC,mBAAA,UAAa,EACbD,mBAAA,CAgBM,OAhBNE,UAgBM,G,0BAfJF,mBAAA,CAAa,YAAT,MAAI,sB,gBACRA,mBAAA,CAAuD;IAR7D,uBAAAG,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAQsBC,KAAA,CAAAC,cAAc,GAAAF,MAAA;IAAEG,WAAW,EAAC;iDAA5BF,KAAA,CAAAC,cAAc,E,mBAC9BN,mBAAA,CAAqE;IAT3E,uBAAAG,MAAA,QAAAA,MAAA,MAAAC,MAAA,IASyBC,KAAA,CAAAG,gBAAgB,GAAAJ,MAAA;IAAEG,WAAW,EAAC;iDAA9BF,KAAA,CAAAG,gBAAgB,E,GACnCR,mBAAA,CAAwC;IAA/BS,OAAK,EAAAN,MAAA,QAAAA,MAAA,UAAAO,IAAA,KAAEC,QAAA,CAAAC,SAAA,IAAAD,QAAA,CAAAC,SAAA,IAAAF,IAAA,CAAS;KAAE,MAAI,GAC/BV,mBAAA,CAUK,c,kBATHF,mBAAA,CAQKe,SAAA,QApBbC,WAAA,CAY+BH,QAAA,CAAAI,aAAa,EAAxBC,MAAM;yBAAlBlB,mBAAA,CAQK;MARkCmB,GAAG,EAAED,MAAM,CAACE,EAAE;MAAGrB,KAAK,EAZrEsB,eAAA;QAAA,iBAY0FH,MAAM,CAACI,QAAQ;MAAA;QAZzGC,gBAAA,CAAAC,gBAAA,CAaaN,MAAM,CAACO,KAAK,IAAG,KAAG,GAAAD,gBAAA,CAAGN,MAAM,CAACQ,OAAO,IAAG,GACzC,iBAAAxB,mBAAA,CAKM,OALNyB,UAKM,GAJJzB,mBAAA,CAES;MAFAS,OAAK,EAAAL,MAAA,IAAEO,QAAA,CAAAe,SAAS,CAACV,MAAM,CAACE,EAAE;wBAC9BF,MAAM,CAACI,QAAQ,8CAhBhCO,UAAA,GAkBY3B,mBAAA,CAAoD;MAA3CS,OAAK,EAAAL,MAAA,IAAEO,QAAA,CAAAiB,YAAY,CAACZ,MAAM,CAACE,EAAE;OAAG,IAAE,iBAlBvDW,UAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}